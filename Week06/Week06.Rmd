
```{r setup, include=FALSE}
knitr::opts_chunk$set(echo = TRUE)
```

### Load library  
```{r message = F, warning = F}
library(tidyverse)
library(Hmisc)
```

### Read in data  
```{r message = F, warning = F}
library(readxl)
setwd("../Week06")
fname <- "week6_coffee_chains.xlsx"
excel_sheets(fname)
dfStar <- read_excel(fname, 1)
dfTimh <- read_excel(fname, 2)
dfDunk <- read_excel(fname, 3)
```

### Fifty States
```{r fig.width = 10}
library(albersusa)
us      <- usa_composite()
us_map  <- broom::tidy(us, region = "name")

library(usmap)
data(statepop)

StarUS <- dfStar %>% 
  rename(ST = `State/Province`) %>%
  filter(Country == "US") %>% 
  mutate(state = openintro::abbr2state(ST))

avgStarUS <- StarUS %>% 
  group_by(state) %>% 
  summarise(count = n(), ST = unique(ST)) %>% 
  left_join(statepop, by = c("ST" = "abbr")) %>% 
  mutate(Avg = count/pop_2015 * 1e5) 


p <- ggplot() +
  geom_map(data = avgStarUS, aes(fill = Avg, map_id = state),
           color="white", size = 0.01, map = us_map) + 
  scale_fill_distiller(name = "Number", palette = "Spectral") +
  expand_limits(x = us_map$long, y = us_map$lat) +
  coord_map() +
  theme_void() +
  theme(legend.position=c(.88, .4))+
  ggtitle( "Starbucks Stores per 100, 000 population" ) +
  labs(caption = "Source: US Census Demogrpahic Data 2015")
p
#p + coord_map("polyconic")
```

### Dot Density Map for CONUS
```{r fig.width = 10}
StarCONUS <- filter(StarUS, ST != "HI" & ST != "AK")
avgStarCONUS <- filter(avgStarUS, ST != "HI" & ST != "AK")
 
t <- ggplot() +
  geom_map(data = avgStarCONUS, aes(fill = Avg, map_id = state),
           color="white", size = 0.01, map = us_map) + 
  scale_fill_distiller(name = "Number", palette = "Spectral") +
  geom_point(data = StarCONUS, aes(x = Longitude, y = Latitude), size = 0.04, alpha = 0.1) +

  expand_limits(x = us_map$long, y = us_map$lat) +
  coord_map() +
  theme_void() +
  theme(legend.position=c(.88, .4))+
  ggtitle( "Starbucks Stores per 100, 000 population" ) +
  labs(caption = "Source: US Census Demogrpahic Data 2015")
t
#t + coord_map("polyconic")
```





